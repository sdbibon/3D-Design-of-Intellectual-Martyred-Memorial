var FO;!function(e){var t;!function(e){var t;!function(e){function t(e){var t,r,n,o=0;if(0==e.length)return o;for(t=0,n=e.length;n>t;t++)r=e.charCodeAt(t),o=(o<<5)-o+r,o|=0;return o}function r(e){for(var t="",r=0;e>r;r++){var n=Math.floor(65536*(1+Math.random())).toString(16).substring(1);t+=n}return t.substr(0,e)}function n(){for(var e=[],t="0123456789ABCDEF",r=0;36>r;r++)e[r]=Math.floor(16*Math.random());e[14]=4,e[19]=3&e[19]|8;for(var r=0;36>r;r++)e[r]=t[e[r]];return e[8]=e[13]=e[18]=e[23]="-",e.join("")}function o(e,t){if(e==t)return!0;if("object"!=typeof e&&"object"!=typeof t)return e==t;var r=Object.getOwnPropertyNames(e),n=Object.getOwnPropertyNames(t);if(r.length!=n.length)return!1;for(var i=0;i<r.length;i++){var u=r[i];if(!o(e[u],t[u]))return!1}return!0}function i(e,t){return 0===e.length?t.length:0===t.length?e.length:Math.min(i(e.substr(1),t)+1,i(t.substr(1),e)+1,i(e.substr(1),t.substr(1))+(e[0]!==t[0]?1:0))}function u(e,t){if(0===e.length)return t.length;if(0===t.length)return e.length;var r,n=[];for(r=0;r<=t.length;r++)n[r]=[r];var o;for(o=0;o<=e.length;o++)n[0][o]=o;for(r=1;r<=t.length;r++)for(o=1;o<=e.length;o++)t.charAt(r-1)==e.charAt(o-1)?n[r][o]=n[r-1][o-1]:n[r][o]=Math.min(n[r-1][o-1]+1,Math.min(n[r][o-1]+1,n[r-1][o]+1));return n[t.length][e.length]}function a(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=arguments;return e.replace(/{(\d+)}/g,function(e,t){var r=parseInt(t)+1;if("undefined"==typeof n[r])throw Error("Failed matching format group "+e);return n[r]})}function s(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return e.replace(/{(\w+)}/g,function(e,r){for(var n=0;n<t.length;n++){var o=t[n];if(r in o)return o[r]}throw Error("Failed matching format group "+e)})}function c(e,t){e.addEventListener?e.addEventListener("message",t,!1):e.attachEvent&&e.attachEvent("onmessage",t)}e.stringHash=t,e.generateGuid=r,e.generateUUID=n,e.isEquivalent=o,e.levenshteinDistance=i,e.getEditDistance=u,e.stringFormat=a,e.namedStringFormat=s,e.attachPostMessageHandler=c,e.HOUR_SECONDS=3600,e.DAY_SECONDS=24*e.HOUR_SECONDS,e.WEEK_SECONDS=7*e.DAY_SECONDS,e.MONTH_SECONDS=30*e.DAY_SECONDS}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_557||(e.Shared_0_0_557={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e){this._domain=null,this._domain=e}return e.prototype.domain=function(){return this._domain},e.prototype.innerResourcesRoot=function(){return this.rootUrl()+"/Extras"},e.prototype.outerResourcesRoot=function(){return"//pstatic"+this.domain()+"/nwp/External"},e.prototype.iframeStoreSrc=function(){return this.rootUrl()+"/Store.html"},e.prototype.notifyRoot=function(){return this.apiRoot()},e.prototype.rootUrl=function(){return"//pstatic"+this.domain()+"/nwp/v0_0_557/release"},e.prototype.apiRoot=function(){return"//app"+this.domain()},e.prototype.dynamicContentRoot=function(){return"//jsgnr"+this.domain()},e.prototype.cachedApiRoot=function(){return"//capp"+this.domain()},e.prototype.blackWhiteListRoot=function(){return"//cwbl"+this.domain()},e.prototype.shortCacheRoot=function(){return"//istatic"+this.domain()},e.prototype.longCacheRoot=function(){return"//pstatic"+this.domain()},e}();e.Paths=t}(t=e.Context||(e.Context={}))}(t=e.Shared_0_0_557||(e.Shared_0_0_557={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(e){this.resolvedOverrides={},e.params()&&e.params().flags&&(e.params().flags.base.value&&this.resolveAndApplyOverrides(e,e.params().flags.base.value,"base"),e.params().flags.specific.value&&this.resolveAndApplyOverrides(e,e.params().flags.specific.value,"specific"))}return e.prototype.resolveAndApplyOverrides=function(e,t,r){for(var n=0;n<t.length;n++)for(var o=t[n],i=r+"."+o.name,u=Math.random(),a=0,s=0;s<o.variants.length;s++){var c=o.variants[s],l=i+"."+c.name;if(a+=c.odds,a>u){for(var f=0;f<c.values.length;f++)this.resolvedOverrides[c.values[f].name]={value:c.values[f].val,origin:l},o.flag&&c.flagValue&&e.pushNotificationParam(o.flag,c.flagValue);break}}},e.prototype.value=function(e,t){return void 0===t&&(t=null),e in this.resolvedOverrides?this.resolvedOverrides[e].value:t},e.prototype.floatValue=function(e,t){return void 0===t&&(t=null),e in this.resolvedOverrides?parseFloat(this.resolvedOverrides[e].value):t},e.prototype.intValue=function(e,t){return void 0===t&&(t=null),e in this.resolvedOverrides?parseInt(this.resolvedOverrides[e].value):t},e.prototype.boolValue=function(e,t){return void 0===t&&(t=null),!!this.intValue(e,t?1:0)},e.prototype.describe=function(){var e=[];for(var t in this.resolvedOverrides){var r=this.resolvedOverrides[t];e.push(t+": "+r.value+" ("+r.origin+")")}return e.join("\n")},e}();e.Overrides=t}(t=e.Context||(e.Context={}))}(t=e.Shared_0_0_557||(e.Shared_0_0_557={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(){}return e.resolveReportingProduct=function(e,t){return"pp"==e&&"rs-dual"==t?"rs":"pp"==e&&"rsif"==t?"rs":"pp"==e&&"rsinc"==t?"rs":"pp"==e&&"rsinc2"==t?"rs":"pp"==e&&"rsinc3"==t?"rs":"pp"==e&&"rsinc4"==t?"rs":"pp"==e&&"rsalt"==t?"rs":"pp"==e&&"rsx"==t?"rs":"pp"==e&&"rsy"==t?"rs":"pp"==e&&"bs-dual"==t?"bs":"pp"==e&&"bsif"==t?"rs":"pp"==e&&"bsx"==t?"bs":"pp"==e&&"bsy"==t?"bs":"pp"==e&&"tsx"==t?"ts":"pp"==e&&"tsy"==t?"ts":"pp"==e&&"tb-dual"==t?"tb":"pp"==e&&"tbx"==t?"tb":"pp"==e&&"tby"==t?"tb":"sk"==e&&"sbx"==t?"sb":"sk"==e&&"sby"==t?"sb":"imgdeals"==e&&"gbx"==t?"gb":"imgdeals"==e&&"gby"==t?"gb":"universal-banner"==e?"ub":"rb"==e?"rb":"gb"==e?"gb":"cpn"==e?"cpn":"ppm"==e?"rs":e+"_"+t},e}();e.Reporting=t}(t=e.Logger||(e.Logger={}))}(t=e.Shared_0_0_557||(e.Shared_0_0_557={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function t(){}return t.notify=function(e,r,n,o,i){void 0===n&&(n={}),void 0===o&&(o=1),void 0===i&&(i=!0);var u=r.key;return t.notifyX(e,u,n,o,i)},t.notifyX=function(e,r,n,o,i){void 0===n&&(n={}),void 0===o&&(o=1),void 0===i&&(i=!0);try{var u="notifyrate."+r,a=e.overrides().floatValue(u,o),s=Math.random()<a;if(!s)return!1;var c=t.resolveUrl(e,r,n,i),l=document.body.appendChild(document.createElement("img"));return l.style.zIndex="-100",l.style.position="absolute",l.style.left="0",l.style.top="0",l.src=c,!0}catch(f){return!1}},t.resolveUrl=function(e,r,n,o){void 0===n&&(n={}),void 0===o&&(o=!0);var i=t.resolveParamaters(e,n,o),u="";for(var a in i)u.length>0&&(u+="&"),u+=a+"="+encodeURIComponent(i[a]);var s=e.paths().notifyRoot()+"/a/"+r+"/logo.png?"+u;return s},t.resolveParamaters=function(t,r,n){void 0===r&&(r={}),void 0===n&&(n=!0);var o=t.notificationParams(),i={};if(n)for(var u in o)i[u]=o[u];for(var u in r)i[u]=r[u];if("t"in i||(i.t=(new Date).getTime()+""),i.pr&&i.w){var a=e.Reporting.resolveReportingProduct(i.pr,i.w);a&&(i.rp=a)}return i},t.notifyGenericUrl=function(e,r,n,o){void 0===r&&(r={}),void 0===n&&(n=null),void 0===o&&(o=!1);try{if(r){e+="?";for(var i in r){var u=r[i]+"";e=e+"&"+i+"="+encodeURIComponent(u)}}var a=document.body.appendChild(document.createElement("img")),s="rid"+Math.floor(9999999999*Math.random());return a.id=s,a.style.zIndex="-100",a.style.position="absolute",a.style.left="0",a.style.top="0",a.src=e,o&&n&&setTimeout(function(){var r=!!document.getElementById(s);r||t.notify(n,t.GENERIC,{subtype:"notifyfailue",originalurl:e})},500),s}catch(c){return null}},t.GENERIC={key:"generic"},t.INJECTION={key:"inj"},t.INIT={key:"init"},t.USER={key:"usr"},t.NO_SHOW={key:"noshow"},t.IMPRESSION={key:"wo"},t.HOVER={key:"ho"},t.CLICK={key:"c"},t.EXCEPTION={key:"exception"},t}();e.Analytics=t}(t=e.Logger||(e.Logger={}))}(t=e.Shared_0_0_557||(e.Shared_0_0_557={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){function t(e){e=e||{guess:!0};var t=e.e||null,n=!!e.guess,o=e.mode||null,i=new r,u=i.run(t,o);return n?i.guessAnonymousFunctions(u):u}e.printStackTrace=t;var r=function(){function e(){this.sourceCache={}}return e.prototype.run=function(e,t){return e=e||this.createException(),t=t||this.mode(e),"other"===t?this.other(arguments.callee):this[t](e)},e.prototype.createException=function(){try{this.undef()}catch(e){return e}},e.prototype.mode=function(e){return e.arguments&&e.stack?"chrome":e.stack&&e.sourceURL?"safari":e.stack&&e.number?"ie":e.stack&&e.fileName?"firefox":e.message&&e["opera#sourceloc"]?e.stacktrace?e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?"opera9":"opera10a":"opera9":e.message&&e.stack&&e.stacktrace?e.stacktrace.indexOf("called from line")<0?"opera10b":"opera11":e.stack&&!e.fileName?"chrome":"other"},e.prototype.instrumentFunction=function(e,r,n){e=e||window;var o=e[r];e[r]=function(){return n.call(this,t().slice(4)),e[r]._instrumented.apply(this,arguments)},e[r]._instrumented=o},e.prototype.deinstrumentFunction=function(e,t){e[t].constructor===Function&&e[t]._instrumented&&e[t]._instrumented.constructor===Function&&(e[t]=e[t]._instrumented)},e.prototype.chrome=function(e){return(e.stack+"\n").replace(/^[\s\S]+?\s+at\s+/," at ").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}() ($1)$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}() ($1)").replace(/^(.+) \((.+)\)$/gm,"$1@$2").split("\n").slice(0,-1)},e.prototype.safari=function(e){return e.stack.replace(/\[native code\]\n/m,"").replace(/^(?=\w+Error\:).*$\n/m,"").replace(/^@/gm,"{anonymous}()@").split("\n")},e.prototype.ie=function(e){return e.stack.replace(/^\s*at\s+(.*)$/gm,"$1").replace(/^Anonymous function\s+/gm,"{anonymous}() ").replace(/^(.+)\s+\((.+)\)$/gm,"$1@$2").split("\n").slice(1)},e.prototype.firefox=function(e){return e.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^(?:\((\S*)\))?@/gm,"{anonymous}($1)@").split("\n")},e.prototype.opera11=function(e){for(var t="{anonymous}",r=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/,n=e.stacktrace.split("\n"),o=[],i=0,u=n.length;u>i;i+=2){var a=r.exec(n[i]);if(a){var s=a[4]+":"+a[1]+":"+a[2],c=a[3]||"global code";c=c.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,t),o.push(c+"@"+s+" -- "+n[i+1].replace(/^\s+/,""))}}return o},e.prototype.opera10b=function(e){for(var t=/^(.*)@(.+):(\d+)$/,r=e.stacktrace.split("\n"),n=[],o=0,i=r.length;i>o;o++){var u=t.exec(r[o]);if(u){var a=u[1]?u[1]+"()":"global code";n.push(a+"@"+u[2]+":"+u[3])}}return n},e.prototype.opera10a=function(e){for(var t="{anonymous}",r=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,n=e.stacktrace.split("\n"),o=[],i=0,u=n.length;u>i;i+=2){var a=r.exec(n[i]);if(a){var s=a[3]||t;o.push(s+"()@"+a[2]+":"+a[1]+" -- "+n[i+1].replace(/^\s+/,""))}}return o},e.prototype.opera9=function(e){for(var t="{anonymous}",r=/Line (\d+).*script (?:in )?(\S+)/i,n=e.message.split("\n"),o=[],i=2,u=n.length;u>i;i+=2){var a=r.exec(n[i]);a&&o.push(t+"()@"+a[2]+":"+a[1]+" -- "+n[i+1].replace(/^\s+/,""))}return o},e.prototype.other=function(e){for(var t,r,n="{anonymous}",o=/function(?:\s+([\w$]+))?\s*\(/,i=[],u=10,a=Array.prototype.slice;e&&i.length<u;){t=o.test(e.toString())?RegExp.$1||n:n;try{r=a.call(e.arguments||[])}catch(s){r=["Cannot access arguments: "+s]}i[i.length]=t+"("+this.stringifyArguments(r)+")";try{e=e.caller}catch(s){i[i.length]="Cannot access caller: "+s;break}}return i},e.prototype.stringifyArguments=function(e){for(var t=[],r=Array.prototype.slice,n=0;n<e.length;++n){var o=e[n];void 0===o?t[n]="undefined":null===o?t[n]="null":o.constructor&&(o.constructor===Array?o.length<3?t[n]="["+this.stringifyArguments(o)+"]":t[n]="["+this.stringifyArguments(r.call(o,0,1))+"..."+this.stringifyArguments(r.call(o,-1))+"]":o.constructor===Object?t[n]="#object":o.constructor===Function?t[n]="#function":o.constructor===String?t[n]='"'+o+'"':o.constructor===Number?t[n]=o:t[n]="?")}return t.join(",")},e.prototype.ajax=function(e){var t=this.createXMLHTTPObject();if(t)try{return t.open("GET",e,!1),t.send(null),t.responseText}catch(r){}return""},e.prototype.createXMLHTTPObject=function(){for(var e,t=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],r=0;r<t.length;r++)try{return e=t[r](),this.createXMLHTTPObject=t[r],e}catch(n){}},e.prototype.isSameDomain=function(e){return"undefined"!=typeof location&&-1!==e.indexOf(location.hostname)},e.prototype.getSource=function(e){return e in this.sourceCache||(this.sourceCache[e]=this.ajax(e).split("\n")),this.sourceCache[e]},e.prototype.guessAnonymousFunctions=function(e){for(var t=0;t<e.length;++t){var r=/\{anonymous\}\(.*\)@(.*)/,n=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,o=e[t],i=r.exec(o);if(i){var u=n.exec(i[1]);if(u){var a=u[1],s=u[2],c=u[3]||0;if(a&&this.isSameDomain(a)&&s){var l=this.guessAnonymousFunction(a,s,c);e[t]=o.replace("{anonymous}",l)}}}}return e},e.prototype.guessAnonymousFunction=function(e,t,r){var n;try{n=this.findFunctionName(this.getSource(e),t)}catch(o){n="getSource failed with url: "+e+", exception: "+o.toString()}return n},e.prototype.findFunctionName=function(e,t){for(var r,n,o,i=/function\s+([^(]*?)\s*\(([^)]*)\)/,u=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*function\b/,a=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*(?:eval|new Function)\b/,s="",c=Math.min(t,20),l=0;c>l;++l)if(r=e[t-l-1],o=r.indexOf("//"),o>=0&&(r=r.substr(0,o)),r){if(s=r+s,n=u.exec(s),n&&n[1])return n[1];if(n=i.exec(s),n&&n[1])return n[1];if(n=a.exec(s),n&&n[1])return n[1]}return"(?)"},e}()}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_557||(e.Shared_0_0_557={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){function r(e){void 0===e&&(e=!1),t.logToConsole=e,console.log&&(t.log=console.log.bind(console),t.info=console.info?console.info.bind(console):console.log.bind(console),t.warn=console.warn?console.warn.bind(console):console.log.bind(console),t.error=console.error?console.error.bind(console):console.log.bind(console),t.time=console.time?console.time.bind(console):console.log.bind(console),t.timeEnd=console.timeEnd?console.timeEnd.bind(console):console.log.bind(console))}function n(e){t.logContext=e,r(e.isDebugMode()),window.FO_NATIVE_DEBUG||(t.log=o,t.info=i,t.warn=u,t.error=a,t.time=s,t.timeEnd=c)}function o(e){l(15e3,e)}function i(e){l(2e4,e)}function u(e){l(3e4,e)}function a(e,r){void 0===r&&(r=t.logContext),l(4e4,e,r)}function s(e){t.logToConsole&&console.time&&console.time(e),t.log("TIMER_START: "+e)}function c(e){if(t.logToConsole&&console.timeEnd&&console.timeEnd(e),t.logstack)for(var r=0;r<t.logstack.length;r++){var n=t.logstack[r];if(n.msg=="TIMER_START: "+e){var o=Date.now()-n.time;return t.log("TIMER END: "+e+"("+o+"ms elapsed)"),o}}}function l(e,r,n){void 0===n&&(n=t.logContext);try{var o=f();if(t.logToConsole){var i=m[e];i||(i=function(e){return console.log(e)});var u="FO - "+(o?r+" @ "+o:r);i(u)}t.logstack||(t.logstack=[]);var a={time:Date.now(),level:e,msg:r,source:o};t.logstack.push(a),a.level>=t.callHomeLevel&&p(t.logstack,r,n)}catch(s){}}function f(){try{var t=e.Common.printStackTrace(),r=t[6],n=r.match(/^[^@]*/)[0];return"{anonymous}()"==n?null:n}catch(o){return null}}function p(e,r,n){try{for(var o="",i=0;i<e.length;i++){var u=e[i];u.level>=3e4&&"string"==typeof u.msg&&(o.length>0&&(o+=" --- "),o+=g[u.level]+" "+u.msg)}o.length>1024&&(o=o.substr(o.length-1024)),o||(o=r);var a={ex:o};t.Analytics.notify(n,t.Analytics.EXCEPTION,a,0)}catch(s){}}function h(){v(t.logstack)}function v(e){if(e)for(var t=0;t<e.length;t++){var r=e[t];1e4==r.level&&console.debug(r.msg),15e3==r.level&&console.log(r.msg),2e4==r.level&&console.info(r.msg),3e4==r.level&&console.warn(r.msg),4e4==r.level&&console.error(r.msg)}}function d(e,r,n){window.setTimeout(function(){for(var n=0;n<t.logstack.length;n++){var o=t.logstack[n],i=r(o,t.logstack);if(i)return}t.error("Failure on EXPECT "+e)},n)}!function(e){e[e.FATAL=5e4]="FATAL",e[e.ERROR=4e4]="ERROR",e[e.WARN=3e4]="WARN",e[e.INFO=2e4]="INFO",e[e.LOG=15e3]="LOG",e[e.DEBUG=1e4]="DEBUG",e[e.TRACE=5e3]="TRACE"}(t.LogLevel||(t.LogLevel={}));var g=t.LogLevel,m={1e4:function(e){return console.debug(e)},15e3:function(e){return console.log(e)},2e4:function(e){return console.info(e)},3e4:function(e){return console.warn(e)},4e4:function(e){return console.error(e)}};t.logToConsole,t.logstack,t.callHomeLevel=4e4,t.logContext,t.initializeWithoutContext=r,t.initialize=n,t.log,t.info,t.warn,t.error,t.time,t.timeEnd,r(!!window.FO_NATIVE_DEBUG),t.flushToConsole=h,t.expect=d}(t=e.Logger||(e.Logger={}))}(t=e.Shared_0_0_557||(e.Shared_0_0_557={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function t(t,r,n,o){void 0===o&&(o=null),this._isDebugMode=!1,this.extraParams={},this.extraParams={},this._paths=t,this._params=r,this._host=window.location.host,this._isDebugMode=this.determineIsDebugMode(),this._overrides=o?o:new e.Overrides(this);for(var i in n)this.extraParams[i]=n[i]}return t.prototype.paths=function(){return this._paths},t.prototype.params=function(){return this._params},t.prototype.host=function(){return this._host},t.prototype.isDebugMode=function(){return this._isDebugMode},t.prototype.overrides=function(){return this._overrides},t.prototype.determineIsDebugMode=function(){return!!window.FO_DEBUG},t.prototype.pushNotificationParam=function(e,t){this.extraParams[e]=t},t.prototype.notificationParams=function(){var e={hn:this.host(),partid:this.params()?this.params().partnerCode:"",subid:this.params()?this.params().subId:"",v:"0_0_557",fam:"nwp",dmn:this.paths().domain(),safepassage:"1"};for(var t in this.extraParams)e[t]=this.extraParams[t];return e},t}();e.BootstrapContext=t}(t=e.Context||(e.Context={}))}(t=e.Shared_0_0_557||(e.Shared_0_0_557={}))}(FO||(FO={}));var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},FO;!function(e){var t;!function(e){var t;!function(e){var t=function(){function e(){}return e}();e.Pair=t,function(e){e[e.CONTINUE=0]="CONTINUE",e[e.BREAK_NODE=1]="BREAK_NODE",e[e.BREAK_ALL=2]="BREAK_ALL"}(e.RecursionFlow||(e.RecursionFlow={}));var r=(e.RecursionFlow,function(){function e(e){this.source=null,this.source=e}return e.of=function(t){return new e(t)},e.ofElements=function(t){for(var r=[],n=0;n<t.length;n++)r.push(t.item(n));return new e(r)},e.empty=function(){return new e([])},e.prototype.unique=function(){var t={};return new e(this.source.filter(function(e){var r=""+e;return t.hasOwnProperty(r)?!1:t[r]=!0}))},e.prototype.length=function(){return this.source.length},e.prototype.getItem=function(e){return this.source[e]},e.prototype.each=function(e){n.each(this.source,e)},e.prototype.select=function(t){return e.of(n.select(this.source,t))},e.prototype.slice=function(t,r){for(var n=[],o=t;r>o;o++)n.push(this.source[o]);return new e(n)},e.prototype.stableSort=function(t){function r(e,t){if(null==e)return[];if(e.length<2)return e;null==t&&(t=n);var i,u,a;return i=~~(e.length/2),u=r(e.slice(0,i),t),a=r(e.slice(i,e.length),t),o(u,a,t)}function n(e,t){return t>e?-1:e>t?1:0}function o(e,t,r){for(var n=[];e.length&&t.length;)n.push(r(e[0],t[0])<=0?e.shift():t.shift());return e.length&&n.push.apply(n,e),t.length&&n.push.apply(n,t),n}var i=r(this.source,t);return e.of(i)},e.prototype.sort=function(t){var r=this.source.slice(0);return r.sort(t),e.of(r)},e.prototype.orderBy=function(e){return this.sort(function(t,r){return e(t)-e(r)})},e.prototype.orderByDesc=function(e){return this.sort(function(t,r){return e(r)-e(t)})},e.prototype.where=function(t){return e.of(n.where(this.source,t))},e.prototype.skip=function(t){if(t>=this.source.length)return new e([]);var r=this.source.slice(t);return e.of(r)},e.prototype.take=function(t){var r=this.source.slice(0,t);return e.of(r)},e.prototype.firstOrValue=function(e){return this.source.length?this.source[0]:e},e.prototype.first=function(e,t){void 0===t&&(t=null);for(var r=0;r<this.source.length;r++)if(e(this.source[r]))return this.source[r];return t},e.prototype.count=function(e){return n.count(this.source,e)},e.prototype.any=function(e){return n.any(this.source,e)},e.prototype.mergeCol=function(t){var r=this.source.concat(t.source);return e.of(r)},e.prototype.merge=function(t){var r=this.source.concat(t);return e.of(r)},e.prototype.normalize=function(e,t,r,n){if(void 0===r&&(r=0),void 0===n&&(n=1),0!=this.length()){var o=e(this.minBy(e)),i=e(this.maxBy(e));this.each(function(u){var a=e(u),s=i>o?(a-o)/(i-o):n-r/2;t(u,s)})}},e.prototype.distinct=function(t){return e.of(n.distinct(this.source,t))},e.prototype.sum=function(e){return n.aggregate(this.source,0,function(t,r){return r+e(t)})},e.prototype.maxBy=function(e){return n.maxBy(this.source,e)},e.prototype.minBy=function(e){return this.maxBy(function(t){return-e(t)})},e.prototype.stringJoin=function(e){return this.source.join(e)},e.prototype.groupBy=function(e){var t=n.orderedGroupByString(this.source,e);return t},e.prototype.selectMany=function(t){var r=[];return this.each(function(e){return r=r.concat(t(e))}),e.of(r)},e.prototype.selectFirst=function(e,t){void 0===t&&(t=function(e){return!!e});for(var r=0;r<this.source.length;r++){var n=e(this.source[r]);if(t(n))return n}return null},e.prototype.toMap=function(e,t){var r=this.select(function(r){return{key:e(r),value:t(r)}});return new o(r.toArray())},e.prototype.toHashmap=function(e){return n.toHashmap(this.source,e)},e.prototype.toHashmap2=function(e,t){return n.toHashmap2(this.source,e,t)},e.prototype.toArray=function(){return this.source},e}());e.Col=r;var n=function(){function e(){}return e.count=function(e,t){for(var r=0,n=0;n<e.length;n++)t(e[n])&&r++;return r},e.any=function(e,t){for(var r=0;r<e.length;r++)if(t(e[r]))return!0;return!1},e.each=function(e,t){for(var r=0;r<e.length;r++)t(e[r],r)},e.hashEach=function(e,t){for(var r in e)e.hasOwnProperty(r)&&t(r,e[r])},e.rand=function(e,t){function r(e){for(var t,r,n=e.length;n;)r=Math.floor(Math.random()*n--),t=e[n],e[n]=e[r],e[r]=t;return e}for(var n=[],o=0;o<e.length;o++){var i=t(e[o],o);n.push(i)}return r(n)},e.select=function(e,t){for(var r=[],n=0;n<e.length;n++){var o=t(e[n],n);r.push(o)}return r},e.where=function(e,t){for(var r=[],n=0;n<e.length;n++){var o=t(e[n]);o&&r.push(e[n])}return r},e.filterSelect=function(e,t){for(var r=[],n=0;n<e.length;n++){var o=t(e[n]);null!=o&&r.push(o)}return r},e.flatMap=function(e){for(var t=[],r=0;r<e.length;r++)t=t.concat(e[r]);return t},e.distinct=function(e,t){for(var r={},n=[],o=0;o<e.length;o++){var i=e[o],u=t(i);u in r||(r[t(i)]=!0,n.push(i))}return n},e.exclude=function(e,t){for(var r=[],n=0;n<e.length;n++){for(var o=!1,i=0;i<t.length;n++)if(e[n].toLowerCase()==t[i].toLowerCase()){o=!0;break}o||r.push(e[n])}return r},e.contains=function(e,t){for(var r=0;r<e.length;r++)if(e[r].toLowerCase()==t.toLowerCase())return!0;return!1},e.groupByString=function(e,t){for(var r={},n=0;n<e.length;n++){var o=e[n],i=t(o);i in r||(r[i]=[]),r[i].push(o)}return r},e.orderedGroupByString=function(e,t){for(var r={},n=[],i=0;i<e.length;i++){var u=e[i],a=t(u);a in r||(n.push({key:a,value:[]}),r[a]=n.length-1);var s=r[a];n[s].value.push(u)}return new o(n)},e.hashSelect=function(e,t){var r={};for(var n in e)e.hasOwnProperty(n)&&(r[n]=t(e[n]));return r},e.aggregate=function(e,t,r){for(var n=t,o=0;o<e.length;o++)n=r(e[o],n);return n},e.hashAggregate=function(e,t,r){var n=t;for(var o in e){var i=e[o];n=r(o,i,n)}return n},e.sum=function(t,r){return e.aggregate(t,0,function(e,t){return t+r(e)})},e.hashSum=function(t,r){return e.hashAggregate(t,0,function(e,t,n){return n+r(e,t)})},e.values=function(e){var t=[];for(var r in e)t.push(e[r]);return t},e.numValues=function(e){var t=[];for(var r in e)t.push(e[r]);return t},e.maxBy=function(e,t){for(var r=null,n=null,o=0;o<e.length;o++){var i=t(e[o]);(null==r||i>r)&&(r=i,n=e[o])}return n},e.intersect=function(e,t){for(var r=[],n=0;n<e.length;n++)for(var o=0;o<t.length;o++)if(e[n]==t[o]){r.push(e[n]);break}return r},e.getKeys=function(e){var t=[];for(var r in e)t.push(r);return t},e.toArray=function(e,t){var r=[];for(var n in e){var o=e[n],i=t(n,o);r.push(i)}return r},e.valuesCol=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return r.of(t)},e.toHashmap=function(t,r){return e.toHashmap2(t,r,function(e){return e})},e.toHashmap2=function(e,t,r){for(var n={},o=0;o<e.length;o++){var i=e[o],u=r(i),a=t(i);n[a]=u}return n},e.join=function(e,t,r){for(var n=[],o=0;o<e.length;o++)for(var i=e[o],u=0;u<t.length;u++){var a=t[u],s=r(i,a);null!=s&&n.push(s)}return n},e.joinByString=function(e,t,n,o){for(var i={},u=[],a=0;a<e.length;a++){var s=n(e[a]);i[s]=e[a]}for(var a=0;a<t.length;a++){var s=o(t[a]);s in i&&u.push({first:i[s],second:t[a]})}return r.of(u)},e.hashMerge=function(t,r,n){void 0===n&&(n=e.hashMergeDefaultConflictFn);var o={};return e.hashEach(t,function(e,t){return o[e]=t}),e.hashEach(r,function(e,t){e in o?o[e]=n(e,o[e],t):o[e]=t}),o},e.hashMergeDefaultConflictFn=function(e,t,r){throw new Error("Conflict on hash merge. Key: "+e+". First: "+t+". Second: "+r)},e.recurseElements=function(t,r,n){void 0===n&&(n=null);var o=r(t,n);if(1==o||2==o)return o;for(var i=0;i<t.children.length;i++){var u=t.children.item(i),a=e.recurseElements(u,r);if(2==a)return 2}return o},e.recurseNodes=function(t,r,n){void 0===n&&(n=null);var o=r(t,n);if(1==o||2==o)return o;for(var i=0;i<t.childNodes.length;i++){var u=t.childNodes.item(i),a=e.recurseNodes(u,r);if(2==a)return 2}return o},e.repeatString=function(e,t){for(var r=[],n=0;t>n;n++)r.push(e);return r},e.recurseSelectElements=function(t,r,n){var o=r(t),i=o[0],u=o[1];if(0==i)for(var a=0;a<t.children.length;a++){var s=t.children.item(a),c=e.recurseSelectElements(s,r,n),l=c[0],f=c[1];if(u=n(t,u,f),2==l){i=2;break}}return[i,u]},e.recurseSelectElements2=function(t,r,n){var o=r(t),i=o[0],u=o[1],a=[];if(0==i)for(var s=0;s<t.children.length;s++){var c=t.children.item(s),l=e.recurseSelectElements2(c,r,n),f=l[0];if(a.push(l[1]),2==f){i=2;break}}var p=n(u,a);return[i,p]},e}();e.StaticCol=n;var o=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.ofHash=function(e){var r=[];for(var n in e)e.hasOwnProperty(n)&&r.push({key:n,value:e[n]});return new t(r)},t.ofUrlString=function(e){return t.ofHashString(e,"&","=",function(e){return decodeURIComponent(e)})},t.ofHashString=function(e,n,o,i){var u=r.of(e.split(n)),a=u.select(function(e){var t=e.split(o),r=t[0],n=t[1],u=i(n);return{key:r,value:u}}).toArray();return new t(a)},t.emptyMap=function(){return t.ofHash({})},t.prototype.get=function(e){var t=this.first(function(t){return t.key==e});return t?t.value:null},t.prototype.keys=function(){return this.select(function(e){return e.key})},t.prototype.values=function(){return this.select(function(e){return e.value})},t.prototype.selectValues=function(e){var r=this.select(function(t){return{key:t.key,value:e(t)}});return new t(r.toArray())},t}(r);e.Map=o}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_557||(e.Shared_0_0_557={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var r;!function(r){function n(e,t){return{name:e,value:t}}function o(e,t){return t.then(function(t){return n(e,t)})}function i(e,t){void 0===t&&(t=!1);var r=[];for(var n in e){var o=s(n,e[n]);r.push(o)}return a(r,t)}function u(e,t){void 0===t&&(t=!1);var r=[];for(var n in e){var o=s(n,e[n]);r.push(o)}return a(r,t)}function a(e,n){void 0===n&&(n=!1);var o=r.defer(),i=e.length,u={};if(0==i)return o.resolve({}),o.promise();for(var a=0;a<e.length;a++){var s=e[a];s.done(function(e){u[e.name]=e.value,r.StaticCol.getKeys(u).length==i&&o.resolve(u)}).fail(function(e){if(n){t.Logger.warn("Continuing ofter inner error: "+e.message);var r=""+Math.random();u[r]=null}else 1!==o.getStatus()&&o.reject(e)})}return o.promise()}function s(e,t){return t.then(function(t){return{name:e,value:t}})}function c(n){var o=r.defer();return e.$.ajax(n,{dataType:"text"}).done(function(e){o.resolve(e)}).fail(function(e,r,i){var u=i&&i.message||"error"!=r&&r||e.status||e.responseText||"generic error";t.Logger.warn("First level error on jqGet '"+n+"': "+u),o.reject({message:u})}),o.promise()}r.toNamed=n,r.toNamedPromise=o,r.namedWhen3=i,r.namedWhen2=u,r.namedWhen=a,r.namePromise=s,r.jqGetPromise=c}(r=t.Common||(t.Common={}))}(t=e.Shared_0_0_557||(e.Shared_0_0_557={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){function r(){return new R}function n(e){return r().resolve(e).promise()}function o(e){return r().reject(e).promise()}function i(e,t){var n=r(),o=new Array;return u(o,n,e,t),n.promise()}function u(e,t,r,n){var o=r(n);if(!o)return void t.resolve(e);for(;o.next&&2==o.promise.getStatus();)if(e.push(o.promise.getResult()),o=r(o.next),!o)return void t.resolve(e);o.promise.done(function(n){e.push(n),o.next?u(e,t,r,o.next):t.resolve(e)}).fail(function(e){t.reject(e)})}function a(e){return c(function(){return!0},Number.MAX_VALUE,e,!1)}function s(e,t){void 0===t&&(t=Number.MAX_VALUE);var n=r(),o=!1;return window.setTimeout(function(){o||(o=!0,n.reject({message:"Timed out after "+t}))}),e(function(e){o||(o=!0,n.resolve(e))}),n.promise()}function c(e,t,n,o){void 0===t&&(t=0),void 0===n&&(n=500),void 0===o&&(o=!0);var i=r(),u=Date.now(),a=function(){var r=Date.now()-u;if(r>=t)clearInterval(s),i.reject(Error("Timed out after "+r));else{var n=e();"undefined"!=typeof n&&null!=n&&(clearInterval(s),i.resolve(n))}},s=setInterval(a,n);return o&&a(),i.promise()}function l(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var n=r();if(!e.length)return n.resolve([]),n.promise();for(var o=0,i=[],u=0;u<e.length;u++){var a=e[u];a.done(function(t){i.push(t),++o,o===e.length&&1!==n.getStatus()&&n.resolve(i)}).fail(function(e){1!==n.getStatus()&&n.reject(e)})}return n.promise()}function f(t,n){void 0===n&&(n=!1);var o=r();if(!t.length)return o.resolve([]),o.promise();for(var i=0,u=[],a=0;a<t.length;a++){var s=t[a];s.done(function(e){u.push(e),++i,i===t.length&&1!==o.getStatus()&&o.resolve(u)}).fail(function(t){n?(e.Logger.warn("Continuing after inner error: "+t.message),++i):1!==o.getStatus()&&o.reject(t)})}return o.promise()}function p(e,t,n,o,i,u){void 0===u&&(u=6e4);var a=r(),s=(new Date).getTime(),c=null,l=0,f=setInterval(function(){var r=(new Date).getTime();if(r-s>=u)clearInterval(f),a.reject({message:"Timed out after "+(r-s)});else try{var o=e();o==c?r-s>=i&&(clearInterval(f),a.resolve(o)):t(o)&&(n(o),c=o,l=r)}catch(p){a.reject(p)}},o);return a.promise()}function h(e,t){void 0===t&&(t=0);var n=r(),o=null,i=!1;t>0&&(o=setTimeout(function(){i||(i=!0,n.reject({message:"Timedout after "+t}))}));var u=function(e){i||(i=!0,clearTimeout(o),n.resolve(e))};try{e(u)}catch(a){i||(i=!0,clearTimeout(o),n.reject(a))}return n.promise()}function v(e,t){void 0===t&&(t=function(e){return!0});for(var r=n(null),o=0;o<e.length;o++){var i=d(e[o],t,o+1);r=r.alwaysThen(i)}return r}function d(e,t,r){var o=function(r,o,i){return!i&&null!=o&&t(o.value)?n(o):e.value(r).then(function(t){return{name:e.name,value:t}})};return y(o,r)}function g(e,t){return function(){return e(t)}}function m(e,t){return function(r){return e(t,r)}}function y(e,t){return function(r,n){return e(t,r,n)}}function S(e,t){return function(r,n,o){return e(t,r,n,o)}}function _(e,t){void 0===t&&(t=1);for(var r=o({message:"initial state"}),i=0;t>i;i++)r=r.alwaysThen(function(t,r){return r?e():n(t)});return r}function w(e){return function(){return O(e())}}function O(e){return new T(e)}function C(e,t){var n=r();return E(n,e(),t),n.promise()}function E(e,t,r){t.advance().done(function(n){return n?(r(t.current),void E(e,t,r)):void e.resolve({})}).fail(function(t){return e.reject(t)})}function k(e){return"undefined"==typeof e}t.defer=r,t.resolve=n,t.reject=o,t.unfold=i,function(e){e[e.Unfulfilled=0]="Unfulfilled",e[e.Rejected=1]="Rejected",e[e.Resolved=2]="Resolved"}(t.Status||(t.Status={}));t.Status;t.wait=a,t.waitForEvent=s,
t.waitFor=c,t.when=l,t.typedWhen=f,t.waitForStable=p,t.promiseFromCallback=h,t.namedWaterfall=v,t.lambda1=g,t.lambda2=m,t.lambda3=y,t.lambda4=S,t.retryPromise=_;var b=function(){function t(e){this.deferred=e}return t.prototype.getStatus=function(){return this.deferred.getStatus()},t.prototype.getResult=function(){return this.deferred.getResult()},t.prototype.getError=function(){return this.deferred.getError()},t.prototype.done=function(e){return this.deferred.done(e),this},t.prototype.fail=function(e){return this.deferred.fail(e),this},t.prototype.always=function(e){return this.deferred.always(e),this},t.prototype.alwaysThen=function(e){return this.deferred.alwaysThen(e)},t.prototype.then=function(e){return this.deferred.then(e)},t.prototype.logPassthrough=function(t){return this.then(function(r){return e.Logger.log("string"==typeof r||r instanceof String?t+": "+r:t+": "+JSON3.stringify(r)),r})},t}(),R=function(){function t(){this._resolved=function(e){},this._rejected=function(e){},this._status=0,this._error={message:""},this._promise=new b(this)}return t.prototype.promise=function(){return this._promise},t.prototype.getStatus=function(){return this._status},t.prototype.getResult=function(){if(2!=this._status)throw new Error("Promise: result not available");return this._result},t.prototype.getError=function(){if(1!=this._status)throw new Error("Promise: rejection reason not available");return this._error},t.prototype.thenOld=function(e){var t=r();return this.done(function(r){var n=e(r);if(n&&"function"==typeof n.done&&n.deferred){var o=n;return o.done(function(e){return t.resolve(e)}).fail(function(e){return t.reject(e)}),o}t.resolve(n)}).fail(function(e){return t.reject(e)}),t.promise()},t.prototype.then=function(t){var n=r();return this.done(function(r){var o=null;try{o=t(r)}catch(i){return e.Logger.warn("First level error: "+i.message+" @ "+t),void n.reject(i)}if(o&&"function"==typeof o.done&&o.deferred){var u=o;return u.done(function(e){return n.resolve(e)}).fail(function(e){return n.reject(e)}),u}n.resolve(o)}).fail(function(e){return n.reject(e)}),n.promise()},t.prototype.alwaysThen=function(t){var n=r(),o=function(r,o){var i=null;try{i=t(r,o)}catch(u){return e.Logger.warn("First level error: "+u.message+" @ "+t),void n.reject(u)}if(i&&"function"==typeof i.done&&i.deferred){var a=i;return a.done(function(e){return n.resolve(e)}).fail(function(e){return n.reject(e)}),a}n.resolve(i)};return this.done(function(e){return o(e,null)}).fail(function(e){return o(null,e)}),n.promise()},t.prototype.done=function(e){if(2===this.getStatus())return e(this._result),this;if(0!==this.getStatus())return this;var t=this._resolved;return this._resolved=function(r){t(r),e(r)},this},t.prototype.fail=function(e){if(1===this.getStatus())return e(this._error),this;if(0!==this.getStatus())return this;var t=this._rejected;return this._rejected=function(r){t(r),e(r)},this},t.prototype.always=function(e){return this.done(function(t){return e(t)}).fail(function(t){return e(null,t)}),this},t.prototype.resolve=function(e){if(0!==this._status)throw new Error("tried to resolve a fulfilled promise");return this._result=e,this._status=2,this._resolved(e),this.detach(),this},t.prototype.reject=function(e){if(0!==this._status)throw new Error("tried to reject a fulfilled promise");return this._error=e,this._status=1,this._rejected(e),this.detach(),this},t.prototype.detach=function(){this._resolved=function(e){},this._rejected=function(e){}},t}();t.generator=w,t.iterator=O;var T=function(){function e(e){this.f=e,this.current=void 0}return e.prototype.advance=function(){var e=this,t=this.f();return t.then(function(t){return k(t)?!1:(e.current=t,!0)})},e}();t.each=C,t.isUndefined=k}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_557||(e.Shared_0_0_557={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var r=function(){function t(){}return t.getCookie=function(e){for(var t=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var o=r[n];" "==o.charAt(0);)o=o.substring(1);if(-1!=o.indexOf(t))return o.substring(t.length,o.length)}return""},t.setCookie=function(e,t,r,n){var o="";r&&(new Date((new Date).getTime()+24*r*60*60*1e3).toUTCString(),o="; expires="+new Date((new Date).getTime()+24*r*60*60*1e3).toUTCString());var i="";n&&(i="; domain="+n),document.cookie=e+"="+t+o+"; path=/"+i},t.setBackendClickCookie=function(t,r){void 0===r&&(r={});try{var n=t.paths().notifyRoot()+"/c/clk/logo.png",o=t.paths().domain();if(n+="?",n=n+"&domain="+encodeURIComponent(o),r)for(var i in r){var u=r[i]+"";n=n+"&"+i+"="+encodeURIComponent(u)}e.Logger.Analytics.notifyGenericUrl(n)}catch(a){}},t}();t.CookieUtils=r}(t=e.Common||(e.Common={}))}(t=e.Shared_0_0_557||(e.Shared_0_0_557={}))}(FO||(FO={}));var FO;!function(e){var t;!function(t){var r;!function(r){var n=function(){function n(){}return n.storeImpressionKeywords=function(e,t){n.storeKeywords(e,t,n.RT_IMPRESSIONS_KEY),e.iframe().postRequest("storeImpressionCookie",!1,null,t)},n.storeClickKeywords=function(e,t){var o=n.storeKeywords(e,t,n.RT_CLICKS_KEY);e.iframe().postRequest("storeClickCookie",!1,null,t),r.CookieUtils.setBackendClickCookie(e,{clk:o})},n.storeKeywords=function(e,t,n){var o=localStorage.getItem(n),i=o?JSON3.parse(o):[];return i.push({keywords:t.split(" "),when:(new Date).getTime()}),i=r.Col.of(i).orderBy(function(e){return e.when}).take(10).toArray(),o=JSON3.stringify(i),localStorage.setItem(n,o),o},n.storeClickKeywordsToCookie=function(e,t,r){n.storeKeywordsToCookie(e,t,n.RT_CLICKS_KEY,r)},n.storeImpressionKeywordsToCookie=function(e,t,r){n.storeKeywordsToCookie(e,t,n.RT_IMPRESSIONS_KEY,r)},n.storeKeywordsToCookie=function(e,n,o,i){var u,a=r.CookieUtils.getCookie(o);try{a=a?decodeURIComponent(a):"",u=a?JSON3.parse(a):[]}catch(s){t.Logger.warn("error in Json.Parse on "+a),u=[]}u.push({keywords:n.split(" "),when:(new Date).getTime()}),u=r.Col.of(u).orderBy(function(e){return e.when}).take(10).toArray(),a=JSON3.stringify(u),r.CookieUtils.setCookie(o,a,365,i)},n.getRetargetingKeywordsFromLocalStorage=function(e){var t=n.readRecentKewwordsFromSource(n.RT_IMPRESSIONS_KEY),r=n.readRecentKewwordsFromSource(n.RT_CLICKS_KEY);return n.getRetargetingKeywords(e,t,r)},n.getRetargetingKeywordsFromCookie=function(e){var t=n.readRecentKewwordsFromCookieSource(n.RT_IMPRESSIONS_KEY),r=n.readRecentKewwordsFromCookieSource(n.RT_CLICKS_KEY);return n.getRetargetingKeywords(e,t,r)},n.readRecentKewwordsFromSource=function(e){var t=((new Date).getTime(),localStorage.getItem(e)),n=t?JSON3.parse(t):[];return r.Col.of(n).orderByDesc(function(e){return e.when})},n.readRecentKewwordsFromCookieSource=function(e){var t=((new Date).getTime(),r.CookieUtils.getCookie(e)),n=t?JSON3.parse(t):[];return r.Col.of(n).orderByDesc(function(e){return e.when})},n.getRetargetingKeywords=function(e,t,r){var o=e.overrides().boolValue("retarget.oldalgo",!0);return o?n.getRetargetingKeywords_OldAlgo(e,t,r):n.getRetargetingKeywords_new(e,t,r)},n.getRetargetingKeywords_new=function(t,n,o){var i=t.overrides().floatValue("retarget-weights.type",2),u=t.overrides().floatValue("retarget-weights.age",2),a=t.overrides().floatValue("retarget-weights.page-match",2),s=t.overrides().floatValue("retarget-weights.word-repeat",2),c=n.select(function(e){return{keywords:e.keywords,when:e.when,typeScore:0,ageScore:null,repeatScore:null,matchScore:null,normTypeScore:null,normAgeScore:null,normRepeatScore:null,normMatchScore:null,totalScore:null}}),l=o.select(function(e){return{keywords:e.keywords,when:e.when,typeScore:1,ageScore:null,repeatScore:null,matchScore:null,normTypeScore:null,normAgeScore:null,normRepeatScore:null,normMatchScore:null,totalScore:null}}),f=c.mergeCol(l);if(0==f.length())return[];var p=f.minBy(function(e){return e.when}).when,h={};f.each(function(e){r.Col.of(e.keywords).each(function(e){h[e]=h[e]?h[e]+=1:1})});var v=e.$("body").text(),d=r.StaticCol.aggregate(v.split(/\W+/gi),{},function(e,t){return e.length>0&&(t[e]=e in t?t[e]+1:1),t});f.each(function(e){e.ageScore=(e.when-p)/(1e3*r.DAY_SECONDS),e.repeatScore=r.StaticCol.sum(e.keywords,function(e){return h[e]}),e.matchScore=r.StaticCol.sum(e.keywords,function(e){return e in d?d[e]:0})}),f.normalize(function(e){return e.ageScore},function(e,t){return e.normAgeScore=t}),f.normalize(function(e){return e.typeScore},function(e,t){return e.normTypeScore=t}),f.normalize(function(e){return e.repeatScore},function(e,t){return e.normRepeatScore=t}),f.normalize(function(e){return e.matchScore},function(e,t){return e.normMatchScore=t}),f.each(function(e){e.totalScore=e.normTypeScore*i+e.normAgeScore*u+e.normRepeatScore*s+e.normMatchScore*a});var g=f.orderByDesc(function(e){return e.totalScore}).firstOrValue(null);return g.keywords},n.getRetargetingKeywords_OldAlgo=function(e,t,o){var i={};t.each(function(e){r.Col.of(e.keywords).each(function(e){i[e]=i[e]?i[e]+=1:1})}),o.each(function(e){r.Col.of(e.keywords).each(function(e){i[e]=i[e]?i[e]+=2:2})});var u=t.select(function(e,t){var o=r.StaticCol.sum(e.keywords,function(e){return i[e]}),u=o*(n.POSITION_WEIGHT+t);return{keywords:e.keywords,score:u}}),a=o.select(function(e,t){var o=r.StaticCol.sum(e.keywords,function(e){return i[e]}),u=o*(n.POSITION_WEIGHT+t);return{keywords:e.keywords,score:u}}),s={keywords:[],score:0},c=u.orderByDesc(function(e){return e.score}).firstOrValue(s),l=a.orderByDesc(function(e){return e.score}).firstOrValue(s);return c.score>l.score?c.keywords:l.keywords},n.RT_CLICKS_KEY="fo-rt-clk",n.RT_IMPRESSIONS_KEY="fo-rt-imp",n.POSITION_WEIGHT=8,n}();r.Retargeting=n}(r=t.Common||(t.Common={}))}(t=e.Shared_0_0_557||(e.Shared_0_0_557={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var r=function(){function t(){}return t.prototype.setItem=function(r,n,o){if("userSettings"==n){var i=JSON.parse(o),u=r.getItem("fouhid");if("uuid"in i){var a=i.uuid;if(u&&a!=u)throw Error("UUID and legacy UUID mismatch");r.setItem("fouhid",a)}if("suspend"in i)for(var s=0;s<t.suspendIds.length;s++){var c=t.suspendIds[s].nwp,l=t.suspendIds[s].old;if(c in i.suspend){var f=i.suspend[c],p=r.getItem(u+"_"+l)?JSON.parse(r.getItem(u+"_"+l)):null;p||(p={}),"autoAppear"in f&&(p.autoAppear=f.autoAppear),"timestamp"in f&&(p.timestamp=f.timestamp),e.Logger.log("Replacing legacy "+JSON.stringify(p)+" with "+JSON.stringify(f)),r.setItem(u+"_"+l,JSON.stringify(p))}}}},t.prototype.getItem=function(r,n){if("userSettings"==n){var o=r.getItem("userSettings")?JSON.parse(r.getItem("userSettings")):{},i=r.getItem("fouhid");i&&(o.uuid=i);for(var u=0;u<t.suspendIds.length;u++){var a=t.suspendIds[u].nwp,s=t.suspendIds[u].old,c=r.getItem(i+"_"+s)?JSON.parse(r.getItem(i+"_"+s)):null,l=c&&"timestamp"in c?c.timestamp:null;l&&(o.suspend||(o.suspend={}),o.suspend[a]||(o.suspend[a]={}),o.suspend[a].timestamp=l);var f=c&&"autoAppear"in c?0==c.autoAppear:null;f&&(o.suspend||(o.suspend={}),o.suspend[a]||(o.suspend[a]={}),o.suspend[a].autoAppear=!f)}var p=!0;for(var h in o){p=!1;break}return p?null:(e.Logger.log("Returning "+JSON.stringify(o)+" for legacy considerations"),o)}return null},t.suspendIds=[{nwp:"RIGHT_PANEL",old:"foss"},{nwp:"BOTTOM_PANEL",old:"fobs"},{nwp:"MAIN_TABLE",old:"fomt"},{nwp:"IMAGE_RIGHT",old:"forb"},{nwp:"IMAGE_INNER",old:"fogb"}],t}();t.LegacyTranslationTable=r}(t=e.Extras||(e.Extras={}))}(t=e.Shared_0_0_557||(e.Shared_0_0_557={}))}(FO||(FO={}));var FO;!function(e){var t;!function(e){var t;!function(t){var r=function(){function r(){}return r.context=function(){return this._context},r.initializeContext=function(t){this._context=new e.Context.BootstrapContext(new e.Context.Paths(t),null,{},null)},r.attachHandlers=function(t){r.initializeContext(t),e.Logger.initialize(this.context());try{e.Common.attachPostMessageHandler(window,r.handleWindowMessage),e.Logger.log("IFrame reciever up and running")}catch(n){e.Logger.error("Failed attaching handlers")}},r.handleWindowMessage=function(t){var n=null;try{var n=JSON.parse(t.data)}catch(o){return}try{var i;"retrieveAll"==n.type?(i=r.retrieveAll(),t.source.postMessage(JSON.stringify({id:n.id,value:i}),t.origin)):"retrieve"==n.type?(i=r.retireve(n.key),t.source.postMessage(JSON.stringify({id:n.id,value:i}),t.origin)):"retrieveOrSet"==n.type?(i=r.retrieveOrSet(n.key,n.value),t.source.postMessage(JSON.stringify({id:n.id,value:i}),t.origin)):"store"==n.type?r.store(n.key,n.value):"storeAll"==n.type?r.storeAll(n.value):e.Logger.warn("Unrecognized request "+t.data)}catch(o){e.Logger.error("IFrameReciever error: "+o&&o.message)}},r.retrieveAll=function(){throw Error("Unsupported")},r.retrieveOrSet=function(e,t){var n=r.retireve(e);return n?n:(this.store(e,t),t)},r.retireve=function(e){var t=r.trans.getItem(localStorage,e);return t?t:JSON.parse(localStorage.getItem(e))},r.store=function(e,t){localStorage.setItem(e,JSON.stringify(t)),r.trans.setItem(localStorage,e,JSON.stringify(t))},r.storeAll=function(e){throw Error("Unsupported")},r.trans=new t.LegacyTranslationTable,r}();t.IFrameStoreReciever=r,window.JSON3=JSON;var n=document.location.host.match(/\..*$/)[0];r.attachHandlers(n)}(t=e.Extras||(e.Extras={}))}(t=e.Shared_0_0_557||(e.Shared_0_0_557={}))}(FO||(FO={}));